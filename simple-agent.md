# Evaluations on the Effectiveness of LM Agents with BugSwarm 

We will test the efficacy of CIFailureFix-Agent using `tananaev-traccar-64783123` as an example artifact. It is a Java artifact and from github, we come to know its diff size is 2.

# Setting up the CIFailureFix-Agent

1. Clone the repository
```bash
git clone -b debug https://github.com/BugSwarm/CIFailureFix-Agent.git
```

2. Go inside `CIFailureFix-Agent/swe-agent`
```bash
cd CIFailureFix-Agent/swe-agent
```

3. Run
```bash
python -m pip install --upgrade pip && pip install --editable .
```
at the repository root (as with any python setup, it's recommended to use conda or virtual environments to manage dependencies).

3. Create a `keys.cfg` file. Contents will be like
```bash
GITHUB_TOKEN=""
OPENAI_API_KEY=""
BUGSWARM_TOKEN=""
```

4. Go into `swe-agent` folder and run 
```bash
./setup.sh
```

# Running python script for generating the patch
For generating patch
```bash
python3 run.py --model_name <llm_model_name> --data_path <bugswarm_image_name> --config_file config/default_from_url.yaml  --per_instance_cost_limit 2.0
```
For bugswarm image we are using `tananaev-traccar-64783123`

<llm_model_name> refers the mapped name of the llms. Here is the list of Open-ai models which we can use

| Short Name | Model |
| --- | --- |
| gpt3 | gpt-3.5-turbo-1106 |
| gpt3-legacy | gpt-3.5-turbo-16k-0613|
| gpt4 | gpt-4-1106-preview |
| gpt4-legacy | gpt-4-0613|
| gpt4-0125 | gpt-4-0125-preview|
| gpt4-turbo | gpt-4-turbo-2024-04-09 |
| gpt4o | gpt-4o-2024-05-13|
| gpt-4o-mini | gpt-4o-mini-2024-07-18 |
| gpt4-legacy | gpt-4-0613|
| gpt4-0125 | gpt-4-0125-preview|

if we want to use `gpt-4-1106-preview` we will replace `<llm_model_name>` with `gpt4`
command will be
```bash
python3 run.py --model_name gpt4 --data_path tananaev-traccar-64783123 --config_file config/default_from_url.yaml  --per_instance_cost_limit 2.0
```

# Testing the patch generated by CIFailureFix-Agent(optional):

We will test the generated patch with our hands. Let's follow the steps:

1. We have to find out the container id using this

```bash
docker ps -a
```

After executing this, we will get a list of the containers running. We have to find the id using bugswarm image name

2. Copy the `repo_reset.sh` file into that container

```bash
docker cp repo_reset.sh <container_id>:/home/travis/
```

3. After getting the container id, we will enter into the container

```bash
docker exec -it <container_id> /bin/bash
```

4. Change mode for the script `repo_reset.sh` and execute it.
```bash
chmod +x repo_reset.sh
./repo_reset.sh <build_system> <folder1> <folder2>
```
for the tutorial, we are using `travis` build system, folder1 will be `tananaev`, folder2 will be `traccar`. So the command will be

```bash
./repo_reset.sh travis tananaev traccar
```


5. Enter into the path `/home/travis/build/failed/tananaev/traccar`

```bash
cd /home/travis/build/failed/tananaev/traccar
```

6. Apply the patch on the folder

```bash
cp ~/model.patch /home/travis/build/failed/tananaev/traccar/
git apply model.patch
```

7. Run the script to build the repo to see if the build process is successful 

```bash
cd /usr/local/bin
./run_failed.sh
```